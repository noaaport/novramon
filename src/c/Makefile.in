#
# $Id$
#
@include@ @q@../../Makefile.inc@q@

INSTALL = @INSTALL@
CC = cc
CXX = c++
EXTRA_CFLAGS = -c -Wall -g
#
# debian and centos require the __STDC_FORMAT_MACROS to define
# PRIuMAX and related macros (in c++).
#
EXTRA_CXXFLAGS = -c -Wall -g  -D__STDC_FORMAT_MACROS
LDFLAGS = -Llib/v3

NOVRA_SRC_DIR = lib/v3/src
NOVRA_LIBS = -lRecCom
EXTRA_LIBS = -lncurses

HEADERS = lib/v3/RecComLib.h \
	version.h \
	err.h logfile.h util.h status.h \
	s75.h s75p.h s200.h s75_private.h
COMMON_SOURCES = err.c util.c logfile.c status.cc s75.cc s75p.cc s200.cc
COMMON_OBJECTS = err.o util.o logfile.o status.o s75.o s75p.o s200.o

MON_SOURCE = novramon.cc
MON_TARGET = novramon
MON_OBJECTS = novramon.o

POLL_SOURCE = novrapoll.cc
POLL_OBJECTS = novrapoll.o
POLL_TARGET = novrapoll

TARGET = ${MON_TARGET} ${POLL_TARGET} 

all: ${TARGET}

${HEADERS}:
	cd ${NOVRA_SRC_DIR}; ${MAKE}

@CORULE@ ${HEADERS}
	${CC} ${CFLAGS} ${EXTRA_CFLAGS} $<

@CCORULE@ ${HEADERS}
	${CXX} ${CXXFLAGS} ${EXTRA_CXXFLAGS} $<

${MON_TARGET}: ${MON_OBJECTS} ${COMMON_OBJECTS}
	${CXX} -o ${MON_TARGET} ${MON_OBJECTS} ${COMMON_OBJECTS} \
	${LDFLAGS} ${NOVRA_LIBS} ${EXTRA_LIBS}

${POLL_TARGET}: ${POLL_OBJECTS} ${COMMON_OBJECTS}
	${CXX} -o ${POLL_TARGET} ${POLL_OBJECTS} ${COMMON_OBJECTS} \
	${LDFLAGS} ${NOVRA_LIBS} ${EXTRA_LIBS}

install: all
	${INSTALL} -m 0755 ${MON_TARGET} ${BINDIR}
	${INSTALL} -m 0755 ${POLL_TARGET} ${MYLIBEXECDIR}

clean:
	cd ${NOVRA_SRC_DIR}; ${MAKE} clean
	rm -f *~ ${TARGET} ${MON_OBJECTS} ${POLL_OBJECTS} ${COMMON_OBJECTS}
	rm -f Makefile
